# taotaoMall(基于SOA架构的分布式电商项目)
### 淘淘网上商城是一个综合性的B2C平台
> * 类似京东商城、天猫商城。会员可以在商城浏览商品、下订单，以及参加各种活动。
> * 管理员、运营可以在平台后台管理系统中管理商品、订单、会员等。
> * 客服可以在后台管理系统中处理用户的询问以及投诉。
####电商模式：
* B2B：商家到商家。阿里巴巴，慧聪网、铭万网。
* B2C：商家到用户。京东。
* C2C：用户到用户。淘宝。
* B2B2C：商家到商家到用户。天猫。
* O2O：线上到线下。百度外卖、美团、饿了么。
####技术使用
+ spring (使用aop定义切点,进行事务声明;控制反转管理组件对象;注解和xml联合使用)
+ springmvc
+ mybatis和mybatis逆向工程
+ dubbo服务中间件
+ mysql数据库
+ 使用阿里druid数据库连接池
+ EasyUI(后台管理操作的表现层)
+ redis数据缓存
##开发计划
###*[壹]*
+ 功能分析
+ 架构分析
+ 工程搭建(后台工程)
>>+ 使用maven搭建工程
>>+ 使用maven的tomcat插件启动工程
###*[贰]*
+ 服务中间件dubbo           **重 难**
+ Ssm框架整合。
+ 整合测试  
+ 商品列表查询功能实现。
###*[叁]*
+ 商品类目选择
+ 图片上传
a)图片服务器FastDFS
b)图片上传功能实现
+ 富文本编辑器的使用KindEditor
+ 商品添加功能完成
###*[肆]*
+ 前台系统搭建
+ Cms系统的实现
a)内容分类管理
b)内容管理
+ 前台内容动态展示     
###*[伍]*
+ Redis服务器搭建      
+ 向业务逻辑中添加缓存。  **重 难**
+ 使用redis做缓存
+ 缓存同步。               **重 难**
+ Solr服务器安装
###*[陆]*
+ Solrj使用测试
+ 把数据库中的数据导入索引库
+ 搜索功能的实现
###*[柒]*
+ solr集群搭建              **难**
+ 使用solrj管理solr集群
+ 把搜索功能切换到集群版
###*[捌]*
+ 什么是MQ
+ MQ的应用场景
+ ActiveMQ的使用方法。 
+ 使用消息队列实现商品同步。    **难**
###*[玖]*
+ 商品详情页面展示，动态展示 jsp + redis
+ 使用freemarker实现网页静态化   
+ ActiveMq同步生成静态网页
###*[拾]*                 **重 难**
+ nginx的安装        
+ Nginx配置虚拟机
+ Nginx实现反向代理       
+ Nginx实现负载均衡       
+ Sso系统工程搭建
###*[拾壹]*                   **重 难**
+ sso注册功能实现              
+ sso登录功能实现
+ 通过token获得用户信息       
+ Ajax跨域请求（jsonp）
###*[拾贰]*
+ 购物车实现
+ 订单确认页面展示
###*[拾叁]*
+ 订单系统完成
+ 系统部署
#####分布式架构：多个子系统相互协作才能完成业务流程。系统之间需要进行通信。(webService,rs, dubbo);
#####集群：同一个工程部署到多台服务器上;
####分布式架构：
把系统按照模块拆分成多个子系统。
######优点：
+ 把模块拆分，使用接口通信，降低模块之间的耦合度。
+ 把项目拆分成若干个子项目，不同的团队负责不同的子项目。
+ 增加功能时只需要再增加一个子项目，调用其他系统的接口就可以。
+ 可以灵活的进行分布式部署。
######缺点：
+ 系统之间交互需要使用远程通信，接口开发增加工作量。
+ 各个模块有一些通用的业务逻辑无法公用。
####基于SOA架构
#####SOA：Service Oriented Architecture面向服务的架构。也就是把工程拆分成服务层、表现层两个工程。服务层中包含业务逻辑，只需要对外提供服务即可。表现层只需要处理和页面的交互，业务逻辑都是调用服务层的服务来实现。
####工程搭建使用maven,使用maven管理工程(好处)
* Jar包的管理
* 工程之间的依赖管理
* 自动打包
####Maven的常见打包方式：jar、war、pom
#####Pom工程一般都是父工程，管理jar包的版本、maven插件的版本、统一的依赖管理。聚合工程。
>+ Taotao-parent：父工程，打包方式pom，管理jar包的版本号。 项目中所有工程都应该继承父工程。
  >>+ Taotao-commom：通用的工具类通用的pojo。打包方式jar
  >>+ Taotao-manager：服务层工程。聚合工程。Pom工程
   >>>+ taotao-manager-dao：打包方式jar
   >>>+ taotao-manager-pojo：打包方式jar
   >>>+ taotao-manager-interface：打包方式jar
   >>>+ taotao-manager-service：打包方式：war
  >>+ taotao-manager-web：表现层工程。打包方式war
###*[壹]*
+ 运行数据库文件.
+ pojo类和mapper接口以及sql定义文件使用mybatis逆向工程生成.
  > 逆向工程只能处理单表.如有多表联合操作,需要自己写sql.xml文件
+ linux系统(服务器的部署多使用Linux系统)
>#####基本指令
  >1. pwd -----查看当前所处目录的绝对路径
  >2. mkdir -p ./a/b/c  如果要创建的文件夹的父目录不存在，则自动创建
+ SecureCRT/Xshell/Putty这些软件都是基于一种通用的安全通信协议进行远程登录：SSH协议（安全外壳协议）.SSH协议要求对远程登录者进行身份验证，并有两种认证方式：
  >+ 口令机制——即 “用户名+密码”验证机制<默认机制>
  >+ 密钥机制<需要配置才能生效>
###*[贰]*
#### 系统间通信dubbo
由于淘淘商城是基于soa的架构，表现层和服务层是不同的工程。所以要实现商品列表查询需要两个系统之间进行通信。
+ 如何实现远程通信？
  >1. Webservice：效率不高基于soap协议。项目中不推荐使用。
  >2. 使用restful形式的服务：http+json。很多项目中应用。如果服务太多，服务之间调用关系混乱，需要治疗服务。
  >3. 使用dubbo。使用rpc协议进行远程调用，直接使用socket通信。传输效率高，并且可以统计出系统之间的调用关系、调用次数。
  >4. Dubbox
+ RPC(Remote Procedure Call Protocol)
  >+ 远程过程调用协议
  >- RPC解析:客户端(A)通过互联网调用远程服务器,不知道远程服务器具体实现,只知道远程服务器提供了什么功能.
  >- RPC优点:数据安全
+ 节点角色说明：
  >+ Provider: 暴露服务的服务提供方。provider项目使用接口,因为dubbo不希望consumer调用时知道其实现情况.
  >+ Consumer: 调用远程服务的服务消费方。
  >+ Registry: 服务注册与发现的注册中心。
  >+ Monitor: 统计服务的调用次调和调用时间的监控中心。
  >+ Container: 服务运行容器。
+ 调用关系说明：
  >0. 服务容器负责启动，加载，运行服务提供者。
  >1. 服务提供者在启动时，向注册中心注册自己提供的服务。
  >2. 服务消费者在启动时，向注册中心订阅自己所需的服务。
  >3. 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。
  >4. 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。
  >5. 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。
+ 运行原理
  >启动容器,相当于在启动Dubbo的Provider
    >>+ 启动后会去注册中心进行注册.注册所有可以提供的服务列表
    >>+ 在Consumer启动后会去Registry中获取服务列表和Provider的地址.进行订阅.
    >>+ 当Provider有修改后,注册中心会把消息推送给Consummer
     >>> 使用了观察者设计模式(又叫发布/订阅设计模式)
    >>+ 根据获取到的Provider地址,真实调用Provider中功能.
     >>> 在Consumer方使用了代理设计模式.创建一个Provider方类的一个代理对象.通过代理对象获取Provider中真实功能,起到保护Provider真实功能的作用.
    >>+ Consumer和Provider每隔1分钟向Monitor发送统计信息,统计信息包含,访问次数,频率等.
+ dubbo支持的注册中心
 >+ Zookeeper
   >>1. 优点:支持网络集群 2. 缺点:稳定性受限于Zookeeper
 >+ Redis 
   >>1. 优点:性能高. 2. 缺点:对服务器环境要求较高.
 >+ Multicast
   >>1 优点:面中心化,不需要额外安装软件. 2.缺点:建议同机房(局域网)内使用
 >+ Simple
   >>适用于测试环境.不支持集群.
+ dubbo支持的协议
>+ Dubbo
 >>1. Dubbo官方推荐的协议.
 >>2. 本质:使用NIO和线程池进行处理. 缺点:大文件传输时可能出现文件传输失败问题.
>+ RMI
 >>1. JDK提供的协议,远程方法调用协议.
 >>2. 缺点:偶尔连接失败. 优点:JDK原生,不需要进行额外配置(导入jar)
>+ Hession
  >>1. 优点:基于http协议,http请求支持.
  >>2. 缺点:需要额外导入jar,并在短连接时性能低
+ 远程服务
  >+ 将服务定义部分放在服务提供方remote-provider.xml，将服务引用部分放在服务消费方remote-consumer.xml。
  >+ 在提供方增加暴露服务配置<dubbo:service>，在消费方增加引用服务配置<dubbo:reference>。
  >+ 暴露服务时,默认服务调用超时时间时1s,需要通过timeout进行设置
+ 注册中心
  >+ 注册中心负责服务地址的注册与查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注册中心不转发请求，压力较小。
  >+ 使用dubbo-2.3.3以上版本，建议使用zookeeper注册中心。
Zookeeper是Apacahe Hadoop的子项目，是一个树型的目录服务，支持变更推送，适合作为Dubbo服务的注册中心，工业强度较高，可用于生产环境，并推荐使用
+ dubbo相关依赖
  > 需要注意服务层和表现层都要添加;注意排除项目中依赖,如去除旧版本的spring
####druid数据库连接池
  > Druid是目前最好的数据库连接池，在功能、性能、扩展性方面，都超过其他数据库连接池，包括DBCP、C3P0、BoneCP、Proxool、JBoss DataSource。
####mybatis分页插件Pagehelp
  >+ 逆向工程生成的代码是不支持分页处理的，如果想进行分页需要自己编写mapper，这样就失去逆向工程的意义了。为了提高开发效率可以使用mybatis的分页插件PageHelper。
  >+ 该插件目前支持Oracle,Mysql,MariaDB,SQLite,Hsqldb,PostgreSQL六种数据库分页。 
  >+ pagehelp依赖版本尽可能是4.0以后的版本或者pagehelp-fx版本(分页插件对逆向工程的支持不太好)
    <plugins>
         <!-- com.github.pagehelper为PageHelper类所在包名 -->
         <plugin interceptor="com.github.pagehelper.PageHelper">
             <!-- 设置数据库类型 Oracle,Mysql,MariaDB,SQLite,Hsqldb,PostgreSQL六种数据库-->        
             <property name="dialect" value="mysql"/>
         </plugin>
     </plugins>
###*[叁]*
